<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Table</title>

  <!--================= Remix Icon =================-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.css" />
  <link rel="stylesheet" href="../Assets/css/styles.css" />
</head>
<body>
  <div id="notification" class="notification hidden"></div>
  <section class="sidebar">
    <div class="sidebar-top">
      <a href="" class="sidebar-title">Brew & Bounty</a>
      <img src="../Assets/coffee-beans.png" alt="Logo Icon" />
    </div>

    <hr class="line" />

    <ul class="sidebar-content">
      <a href=""><li><i class="ri-home-2-line"></i>Home</li></a>
      <a href="menu.html"><li><i class="ri-restaurant-2-line"></i>Menu</li></a>
      <a href="cashiers.html"><li><i class="ri-admin-line"></i>Cashiers</li></a>
    </ul>
  </section>

  <section class="main-content">
    <div class="top">
      <a href="" class="top-title">Brew & Bounty > <b>Cashiers</b></a>
      <a href="addCashiers.html" class="add-button">Add Account</a>
    </div>

    <h1 class="main-title">Cashiers</h1>

    <div class="table">
      <div class="table-option">
        <label for="sort" id="sort-label"><i class="ri-filter-3-line"></i>Filter</label>
        <select name="sort" id="sort">
          <option value="ascending">Ascending</option>
          <option value="descending">Descending</option>
        </select>
        <div id="custom-dropdown" class="custom-dropdown">
          <div class="option" data-value="ascending">Ascending</div>
          <div class="option" data-value="descending">Descending</div>
        </div>
      </div>

      <div class="table-content" id="table-content">
        <table>
          <thead>
            <tr>
              <th>Cashier ID</th>
              <th>Profile Image</th>
              <th>Name</th>
              <th>Gender</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>

        <form class="pagination">
          <label for="dataperpage">Lines per Page</label>
          <select name="dataperpage" id="dataperpage">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
          </select>
          <p id="pagination-info">1 - 5 out of ??</p>
          <div class="pagination-button">
            <a href="#" onclick="prevPage()"><i class="ri-arrow-left-s-line"></i></a>
            <a href="#" onclick="nextPage()"><i class="ri-arrow-right-s-line"></i></a>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getStorage, ref as storageRef, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
  apiKey: "AIzaSyDzURQckDxjVYzWHcRSfq0VTBjqwQYhUg0",
  authDomain: "brew-bounty-admin.firebaseapp.com",
  databaseURL: "https://brew-bounty-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "brew-bounty-admin",
  storageBucket: "brew-bounty-admin.appspot.com",
  messagingSenderId: "108525876940",
  appId: "1:108525876940:web:e8eff02f81f9425d65f469",
  measurementId: "G-124F208GM2"
};

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const storage = getStorage(app);

    let cashiers = [];
    let currentPage = 1;
    let itemsPerPage = 5;

    function fetchCashiers() {
      const cashiersRef = ref(database, 'cashiers');
      onValue(cashiersRef, (snapshot) => {
        cashiers = [];
        snapshot.forEach(childSnapshot => {
          cashiers.push({
            id: childSnapshot.key,
            ...childSnapshot.val()
          });
        });
        renderTable();
      });
    }

    function renderTable() {
      const tableBody = document.getElementById('table-body');
      tableBody.innerHTML = '';

      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, cashiers.length);

      for (let i = startIndex; i < endIndex; i++) {
        const cashier = cashiers[i];
        const row = document.createElement('tr');

        row.innerHTML = `
          <td>${cashier.id}</td>
          <td><img src="${cashier.profileImageUrl}" alt="Profile Picture" height="50"></td>
          <td>${cashier.name}</td>
          <td>${cashier.gender}</td>
          <td>${cashier.startDate}</td>
          <td>${cashier.endDate}</td>
          <td>
            <button onclick="editCashier('${cashier.id}')">Edit</button>
            <button onclick="deleteCashier('${cashier.id}', '${cashier.profileImageUrl}')">Delete</button>
          </td>
        `;

        tableBody.appendChild(row);
      }

      updatePaginationInfo();
    }

    function editCashier(id) {
      window.location.href = `editCashiers.html?id=${id}`;
    }

    function deleteCashier(id, imageUrl) {
      if (confirm('Are you sure you want to delete this cashier?')) {
        const imageRef = storageRef(storage, imageUrl);
        deleteObject(imageRef).then(() => {
          const cashierRef = ref(database, `cashiers/${id}`);
          remove(cashierRef).then(() => {
            alert('Cashier deleted successfully');
            fetchCashiers();
          }).catch(error => {
            alert('Error deleting cashier data: ' + error);
          });
        }).catch(error => {
          alert('Error deleting image: ' + error);
        });
      }
    }

    function sortTable(order) {
      if (order === 'ascending') {
        cashiers.sort((a, b) => a.name.localeCompare(b.name));
      } else if (order === 'descending') {
        cashiers.sort((a, b) => b.name.localeCompare(a.name));
      }
      renderTable();
    }

    function updatePagination() {
      itemsPerPage = parseInt(document.getElementById('dataperpage').value);
      currentPage = 1;
      renderTable();
    }

    function updatePaginationInfo() {
      const startIndex = (currentPage - 1) * itemsPerPage + 1;
      const endIndex = Math.min(currentPage * itemsPerPage, cashiers.length);
      document.getElementById('pagination-info').innerText = `${startIndex} - ${endIndex} out of ${cashiers.length}`;
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    function nextPage() {
      if (currentPage * itemsPerPage < cashiers.length) {
        currentPage++;
        renderTable();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchCashiers();

      document.getElementById('sort').addEventListener('change', (e) => {
        sortTable(e.target.value);
      });

      document.getElementById('dataperpage').addEventListener('change', () => {
        updatePagination();
      });
    });
  </script>
</body>
</html>
