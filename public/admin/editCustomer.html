<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brew Bounty Admin - Edit Customer</title>
    <link rel="stylesheet" href="../Assets/css/homepagestyle.css">
</head>
<body>
    <nav>
        <ul class="sidebar">
            <li onclick="closeSidebar()" class="cross"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224-224 224Z"/></svg></a></li>
            <li class="nav-text"><a href="customers.html">Exit</a></li>
        </ul>

        <ul>
            <li class="nav-brand"><a href=""><img class="logo" height="50" src="../Assets/coffee-beans.png">Brew Bounty</a></li>
            <div class="navbar">
                <li class="hideonmobile"><a href="customer.html">Back</a></li>
                <li class="menubutton" onclick="showSidebar()"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg></a></li>
            </div>
        </ul>
    </nav>

    <h2 class="recipe-title">Edit Customer</h2>

    <form id="editForm">
        <label for="customerName">Name:</label>
        <input type="text" id="customerName" name="customerName" required><br><br>

        <label for="customerEmail">Email:</label>
        <input type="email" id="customerEmail" name="customerEmail" required><br><br>
        
        <label for="customerPhone">Phone:</label>
        <input type="tel" id="customerPhone" name="customerPhone" required><br><br>

        <label for="customerAddress">Address:</label><br>
        <textarea id="customerAddress" name="customerAddress" required></textarea><br><br>

        <label for="customerId">ID:</label>
        <input type="text" id="customerId" name="customerId" required readonly><br><br>

        <input type="submit" class="submitButton" value="Update Customer">
    </form>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDzURQckDxjVYzWHcRSfq0VTBjqwQYhUg0",
            authDomain: "brew-bounty-admin.firebaseapp.com",
            databaseURL: "https://brew-bounty-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "brew-bounty-admin",
            storageBucket: "brew-bounty-admin.appspot.com",
            messagingSenderId: "108525876940",
            appId: "1:108525876940:web:e8eff02f81f9425d65f469",
            measurementId: "G-124F208GM2",
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        document.addEventListener("DOMContentLoaded", async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("id");

            if (id) {
                const customerRef = ref(database, `customers/${id}`);
                try {
                    const snapshot = await get(customerRef);
                    if (snapshot.exists()) {
                        const customerData = snapshot.val();
                        document.getElementById("customerName").value = customerData.name;
                        document.getElementById("customerEmail").value = customerData.email;
                        document.getElementById("customerPhone").value = customerData.phone;
                        document.getElementById("customerAddress").value = customerData.address;
                        document.getElementById("customerId").value = id;
                    } else {
                        console.error("No data available for the specified customer");
                    }
                } catch (error) {
                    console.error("Error fetching customer data:", error);
                }
            } else {
                console.error("Missing id in URL parameters");
            }

            document.getElementById("editForm").addEventListener("submit", async (e) => {
                e.preventDefault();
                const customerName = document.getElementById("customerName").value;
                const customerEmail = document.getElementById("customerEmail").value;
                const customerPhone = document.getElementById("customerPhone").value;
                const customerAddress = document.getElementById("customerAddress").value;
                const customerId = document.getElementById("customerId").value;

                const updates = {
                    name: customerName,
                    email: customerEmail,
                    phone: customerPhone,
                    address: customerAddress
                };

                try {
                    await update(ref(database, `customers/${customerId}`), updates);
                    alert("Customer updated successfully");
                    window.location.href = "customer.html";
                } catch (error) {
                    console.error("Error updating customer:", error);
                }
            });
        });
    </script>
</body>
</html>
`